<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planning statistical audit samples • jfa</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Planning statistical audit samples">
<meta property="og:description" content="jfa">
<meta property="og:image" content="https://koenderks.github.io/jfa/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jfa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jfa.html">Get started</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/koenderks/jfa" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/koenderks/jfa/discussions" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Planning statistical audit samples</h1>
                        <h4 data-toc-skip class="author">Koen Derks</h4>
            
            <h4 data-toc-skip class="date">2023-12-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/koenderks/jfa/blob/HEAD/vignettes/sample-planning.Rmd" class="external-link"><code>vignettes/sample-planning.Rmd</code></a></small>
      <div class="hidden name"><code>sample-planning.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette illustrates how to use the <code><a href="../reference/planning.html">planning()</a></code>
function from the <strong>jfa</strong> package to calculate a minimum
sample size for audit sampling.</p>
<p align="center">
<img src="planning.png" alt="planning" width="100%"></p>
</div>
<div class="section level2">
<h2 id="required-information">Required information<a class="anchor" aria-label="anchor" href="#required-information"></a>
</h2>
<p>First, planning a minimum sample requires knowledge of the conditions
that lead to acceptance or rejection of the population (i.e., the
sampling objectives). Typically, sampling objectives can be classified
into one or both of the following:</p>
<ul>
<li>
<strong>Hypothesis testing</strong>: The goal of the sample is to
obtain evidence for or against the claim that the misstatement in the
population is lower than a given value (i.e., the performance
materiality).</li>
<li>
<strong>Estimation</strong>: The goal of the sample is to obtain an
accurate estimate of the misstatement in the population (with a minimum
precision).</li>
</ul>
<p>Second, it is advised to specify the expected (or tolerable)
misstatements in the sample. The expected misstatements are the
misstatements that you allow in the sample, while still retaining the
desired amount of assurance about the population. It is strongly
recommended to set the value for the expected misstatements in the
sample conservatively to minimize the chance of the observed
misstatements in the sample exceeding the expected misstatements, which
would imply that insufficient work has been done in the end.</p>
<p>Next to determining the sampling objective(s) and the expected
misstatements, it is also important to determine the statistical
distribution linking the sample outcomes to the population misstatement.
This distribution is called the likelihood (i.e., <code>poisson</code>,
<code>binomial</code>, or<code>hypergeometric</code>). All three
aforementioned likelihoods are commonly used in an audit sampling
context, however, <code>poisson</code> is the default likelihood in
<strong>jfa</strong> because it is the most conservative of the
three.</p>
</div>
<div class="section level2">
<h2 id="classial-approach">Classial approach<a class="anchor" aria-label="anchor" href="#classial-approach"></a>
</h2>
<p>To illustrate how the <code><a href="../reference/planning.html">planning()</a></code> function can be used to
calculate a minimum sample size for audit sampling, we will first
demonstrate how to set up a sample with the purpose of hypothesis
testing and subsequently show how to plan a sample with the purpose of
estimation. In both cases, we will tolerate zero misstatements in the
sample.</p>
<div class="section level3">
<h3 id="hypothesis-testing">Hypothesis testing<a class="anchor" aria-label="anchor" href="#hypothesis-testing"></a>
</h3>
<p>First, let’s take a look at how you can use the
<code><a href="../reference/planning.html">planning()</a></code> function to calculate the minimum sample size
for testing the hypothesis that the misstatement in the population is
lower than the performance materiality. In this example the performance
materiality is set to three percent of the total population value,
meaning that the population cannot contain more than three percent
misstatement.</p>
<p><strong>Sampling objective</strong>: Calculate a minimum sample size
such that, when no misstatements are found in the sample, there is a 95
percent chance that the misstatement in the population is lower than
three percent of the population value.</p>
<div class="section level4">
<h4 id="single-stage-sampling-plans">Single-stage sampling plans<a class="anchor" aria-label="anchor" href="#single-stage-sampling-plans"></a>
</h4>
<p>Concretely, in a single-stage sampling plan the auditor wants to
directly apply the sampling objective. More specifically, they want to
reduce the risk of the misstatements <span class="math inline">\(k\)</span> coming from a population in which the
misstatement rate is equal to <span class="math inline">\(\theta_{max}\)</span>. This risk should be lower
than the audit risk <span class="math inline">\(\alpha\)</span>.</p>
<p><span class="math display">\[\begin{equation}
  p(k = 0 | n, $\theta_{max}$) \leq \alpha
\end{equation}\]</span></p>
<p>A minimum sample size for this sampling objective can be calculated
by specifying the <code>materiality</code> parameter in the
<code><a href="../reference/planning.html">planning()</a></code> function, see the command below. Next, a summary
of the statistical results can be obtained using the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function. The result shows that, given zero
tolerable misstatements, the minimum sample size is 99 items or units.
The auditor can allow for misstatements (e.g., tolerate <span class="math inline">\(k\)</span> = 1 misstament) in the sample by
providing an integer value to the <code>expected</code> argument of the
function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, expected <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Classical Audit Sample Planning Summary</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Options:</span></span>
<span><span class="co">##   Confidence level:              0.95 </span></span>
<span><span class="co">##   Materiality:                   0.03 </span></span>
<span><span class="co">##   Hypotheses:                    H₀: Θ &gt;= 0.03 vs. H₁: Θ &lt; 0.03 </span></span>
<span><span class="co">##   Expected:                      0 </span></span>
<span><span class="co">##   Likelihood:                    binomial </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results:</span></span>
<span><span class="co">##   Minimum sample size:           99 </span></span>
<span><span class="co">##   Tolerable errors:              0 </span></span>
<span><span class="co">##   Expected most likely error:    0 </span></span>
<span><span class="co">##   Expected upper bound:          0.029807 </span></span>
<span><span class="co">##   Expected precision:            0.029807 </span></span>
<span><span class="co">##   Expected p-value:              0.049023</span></span></code></pre>
<p>This can be verified by making sure that the probability of finding
<span class="math inline">\(k\)</span> = 0 misstatements in <span class="math inline">\(n\)</span> = 99 samples given <span class="math inline">\(\theta_{max}\)</span> = 0.03 is lower than the
audit risk <span class="math inline">\(\alpha\)</span> = 0.05</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">pbinom</a></span><span class="op">(</span>q <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">99</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="multiple-stage-sampling-plans">Multiple-stage sampling plans<a class="anchor" aria-label="anchor" href="#multiple-stage-sampling-plans"></a>
</h4>
<p>Instead of using a single-stage sampling plan, a multi-stage sampling
plan enables the evaluation of the sample at an intermediate stage. If
the results do not provide sufficient evidence to make a conclusion, the
second stage is initiated. More specifically, in the first stage of a
multiple-stage sampling plan the auditor draws an initial sample of size
<span class="math inline">\(n_1\)</span>. If this sample contains a
tolerable number of misstatements (typically 0), then the auditor can
approve the population. However, if the sample contains more than the
tolerable number of misstatements, the population cannot be approved. In
this case, the initial sample is extended with a second sample of <span class="math inline">\(n_2\)</span> items. If this second batch of items
reveals a tolerable number of misstatements, then the population can
still be approved. If this is not the case, then the population should
be rejected or a third sample with <span class="math inline">\(n_3\)</span> items should be inspected.</p>
<p>In the classical (i.e., frequentist) approach, multiple-stage
sampling plans can be computed by breaking down the audit risk into
several components. For instance, if the auditor wants to initially plan
for <span class="math inline">\(k\)</span> = 0 misstatements, but wants
to extend the sample if <span class="math inline">\(k\)</span> = 1
misstatement is found, then the audit risk consists of:</p>
<ul>
<li>
<span class="math inline">\(p(k = 0 | n_1, \theta_{max})\)</span>:
The probability of finding <span class="math inline">\(k\)</span> = 0
misstatements in the first sample of <span class="math inline">\(n_1\)</span> items; plus</li>
<li>
<span class="math inline">\(p(k = 1 | n_1, \theta_{max})\)</span>:
The probability of finding <span class="math inline">\(k\)</span> = 1
misstatement in the first sample of <span class="math inline">\(n_1\)</span> items; multiplied by</li>
<li>
<span class="math inline">\(p(k = 0 | n_2, \theta_{max})\)</span>:
The probability finding <span class="math inline">\(k\)</span> = 0
misstatements in the second sample of <span class="math inline">\(n_2\)</span> items.</li>
</ul>
<p>The sum of these probabilities should be lower than, or equal to, the
audit risk <span class="math inline">\(\alpha\)</span>.</p>
<p><span class="math display">\[\begin{equation}
  p(k = 0 | n_1, \theta_{max}) + p(k = 1 | n_1, \theta_{max}) \cdot p(k
= 0 | n_2, \theta_{max}) \leq \alpha
\end{equation}\]</span></p>
<p>For computational reasons <strong>jfa</strong> specifies the number
of samples in the extension to be equal to that of the initial sample
(<span class="math inline">\(n_1\)</span> = <span class="math inline">\(n_2\)</span> = <span class="math inline">\(n_s\)</span>). This means that the sample size for
a two-stage sampling plan is the smallest integer <span class="math inline">\(n\)</span> that satisfies the condition below.</p>
<p><span class="math display">\[\begin{equation}
  p(k = 0 | n_s, \theta_{max}) + p(k = 1 | n_s, \theta_{max}) \cdot p(k
= 0 | n_s, \theta_{max}) \leq \alpha
\end{equation}\]</span></p>
<p>In <strong>jfa</strong>, multiple-stage sampling plans can be
computed by providing an integer vector of tolerable misstatements in
each stage to the <code><a href="../reference/planning.html">planning()</a></code> function via its
<code>expected</code> argument. For instance, the following code
computed the sample size required if the auditor wants to initially plan
for <span class="math inline">\(k\)</span> = 0 misstatements, but wants
to extend the sample if <span class="math inline">\(k\)</span> = 1
misstatement is found. The required sample size per stage is <span class="math inline">\(n_s\)</span> = 103, with a total sample size (if
both stages are required) of <span class="math inline">\(n\)</span> =
206.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, expected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Classical Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 206 (103 per stage) </span></span>
<span><span class="co">## sample size obtained in 102 iterations via method 'binomial' + 'sequential'</span></span></code></pre>
<p>The correctness of this calculation can be verified by making sure
that the probability of incorrectly rejecting the null hypothesis under
the binomial distribution is below the audit risk <span class="math inline">\(\alpha\)</span> = 0.05.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_k0_n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">103</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">p_k1_n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">103</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">p_k0_n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">103</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">p_k0_n1</span> <span class="op">+</span> <span class="va">p_k1_n1</span> <span class="op">*</span> <span class="va">p_k0_n2</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>The minimal sample size per stage <span class="math inline">\(n_s\)</span> = 103 is only slightly larger than
the minimal sample size for the first stage if the auditor decides to
use a single-stage sampling plan expecting <span class="math inline">\(k\)</span> = 0, which is <span class="math inline">\(n\)</span> = 99.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, expected <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Classical Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 99 </span></span>
<span><span class="co">## sample size obtained in 100 iterations via method 'binomial'</span></span></code></pre>
<p>However, the total sample size <span class="math inline">\(n\)</span>
= 206 is considerably larger larger than the minimal sample size if the
auditor decides to use a single-stage sampling plan expecting <span class="math inline">\(k\)</span> = 1, which is <span class="math inline">\(n\)</span> = 157.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, expected <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Classical Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 157 </span></span>
<span><span class="co">## sample size obtained in 156 iterations via method 'binomial'</span></span></code></pre>
<p>As another example, we discuss a three-stage sampling plan in which
the auditor wants to extend the sample after finding <span class="math inline">\(k\)</span> = 1 misstatements in the first stage,
extend further if they find <span class="math inline">\(k\)</span> = 1
misstatement in the second stage, and still be able to approve the
population if they find <span class="math inline">\(k\)</span> = 0
misstatements in the third stage. The required sample size per each of
the three stages is <span class="math inline">\(n_s\)</span> = 209.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, expected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Classical Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 624 (208 per stage) </span></span>
<span><span class="co">## sample size obtained in 204 iterations via method 'binomial' + 'sequential'</span></span></code></pre>
<p>Again, this can be verified by making sure that the probability of
incorrectly rejecting the null hypothesis of three percent misstatement
is below the audit risk <span class="math inline">\(\alpha\)</span> =
0.05.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_k2_n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">pbinom</a></span><span class="op">(</span>q <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">209</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">p_k3_n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3</span>, size <span class="op">=</span> <span class="fl">209</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">p_k1_n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">pbinom</a></span><span class="op">(</span>q <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">209</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">p_k2_n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">209</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">p_k0_n3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">209</span>, prob <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="va">p_k2_n1</span> <span class="op">+</span> <span class="va">p_k3_n1</span> <span class="op">*</span> <span class="va">p_k1_n2</span> <span class="op">+</span> <span class="va">p_k3_n1</span> <span class="op">*</span> <span class="va">p_k2_n2</span> <span class="op">*</span> <span class="va">p_k0_n3</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>Like before, the minimal sample size per stage <span class="math inline">\(n_s\)</span> = 209 is only slightly larger than
the minimal sample size for the first stage if the auditor decides to
use a single-stage sampling plan, which is <span class="math inline">\(n\)</span> = 208.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, expected <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Classical Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 208 </span></span>
<span><span class="co">## sample size obtained in 206 iterations via method 'binomial'</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h3>
<p>Next, let’s take a look at how you can use the
<code><a href="../reference/planning.html">planning()</a></code> function to calculate the minimum sample size
for estimating the misstatement in the population with a minimum
precision. The precision is defined as the difference between the most
likely misstatement and the upper confidence bound on the misstatement.
For this example, the minimum precision is set to 2 percent of the
population value.</p>
<p><strong>Sampling objective</strong>: Calculate a minimum sample size
such that, when zero misstatements are found in the sample, there is a
95 percent chance that the misstatement in the population is at most 2
percent above the most likely misstatement.</p>
<p>A minimum sample size for this sampling objective can be calculated
by specifying the <code>min.precision</code> parameter in the
<code><a href="../reference/planning.html">planning()</a></code> function, see the command below. The result
shows that, given zero tolerable errors, the minimum sample size is 149
units.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>min.precision <span class="op">=</span> <span class="fl">0.02</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Classical Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 149 </span></span>
<span><span class="co">## sample size obtained in 150 iterations via method 'binomial'</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="bayesian-approach">Bayesian approach<a class="anchor" aria-label="anchor" href="#bayesian-approach"></a>
</h2>
<p>Performing Bayesian planning requires an input for the
<code>prior</code> argument in the <code><a href="../reference/planning.html">planning()</a></code> function.
Setting <code>prior = TRUE</code> performs Bayesian planning using a <a href="https://koenderks.github.io/jfa/articles/creating-prior.html#default-priors-method-default">default
prior</a> conjugate to the specified <code>likelihood</code>. For
example, the command below uses a default gamma(<span class="math inline">\(\alpha = 1\)</span>, <span class="math inline">\(\beta = 1\)</span>) prior distribution to plan the
sample.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Bayesian Audit Sample Planning Summary</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Options:</span></span>
<span><span class="co">##   Confidence level:              0.95 </span></span>
<span><span class="co">##   Materiality:                   0.03 </span></span>
<span><span class="co">##   Hypotheses:                    H₀: Θ &gt; 0.03 vs. H₁: Θ &lt; 0.03 </span></span>
<span><span class="co">##   Expected:                      0 </span></span>
<span><span class="co">##   Likelihood:                    poisson </span></span>
<span><span class="co">##   Prior distribution:            gamma(α = 1, β = 1) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Results:</span></span>
<span><span class="co">##   Minimum sample size:           99 </span></span>
<span><span class="co">##   Tolerable errors:              0 </span></span>
<span><span class="co">##   Posterior distribution:        gamma(α = 1, β = 100) </span></span>
<span><span class="co">##   Expected most likely error:    0 </span></span>
<span><span class="co">##   Expected upper bound:          0.029957 </span></span>
<span><span class="co">##   Expected precision:            0.029957 </span></span>
<span><span class="co">##   Expected BF₁₀:                 626.69</span></span></code></pre>
<p>You can inspect how the prior distribution compares to the expected
posterior distribution by using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function. The
expected posterior distribution is the posterior distribution that would
occur if you actually observed the planned sample containing the
expected misstatements.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code></pre></div>
<p><img src="sample-planning_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Since the Bayesian approach to audit sampling iteratively uses the
posterior distribution from the observed sample as a prior distribution
for a possible second sample, it does not compromise the audit risk as a
function of the number of tests. Therefore, in the Bayesian framework
you can simply start sampling until there is sufficient evidence to make
a decision <span class="citation">(Rouder, 2014)</span>. That means
that, whenever you find <span class="math inline">\(k\)</span> = 1
misstatement in the initial <span class="math inline">\(n\)</span> = 60
samples, computing the sample size extension simply requires you to
compute a single-stage sample size under the expectation of one
tolerable misstatement.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">1</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Bayesian Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 158 </span></span>
<span><span class="co">## sample size obtained in 157 iterations via method 'poisson' + 'prior'</span></span></code></pre>
<p>The input for the <code>prior</code> argument can also be an object
created by the <code>auditPrior</code> function. If
<code><a href="../reference/planning.html">planning()</a></code> receives a prior for which there is a conjugate
likelihood available, it will inherit the likelihood from the prior. For
example, the command below uses a custom beta(<span class="math inline">\(\alpha = 1\)</span>, <span class="math inline">\(\beta = 10\)</span>) prior distribution to plan
the sample using the binomial likelihood.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auditPrior.html">auditPrior</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"param"</span>, likelihood <span class="op">=</span> <span class="st">"binomial"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span>materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Bayesian Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 89 </span></span>
<span><span class="co">## sample size obtained in 90 iterations via method 'binomial' + 'prior'</span></span></code></pre>
<p>However, when there is no conjugate likelihood available, specifying
the <code>likelihood</code> argument in <code><a href="../reference/planning.html">planning()</a></code> is
required. For instance, the command below uses a Normal(<span class="math inline">\(\mu = 0\)</span>, <span class="math inline">\(\sigma = 0.1\)</span>) prior in combination with
the binomial likelihood to plan the sample size.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auditPrior.html">auditPrior</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"param"</span>, likelihood <span class="op">=</span> <span class="st">"normal"</span>, alpha <span class="op">=</span> <span class="fl">0</span>, beta <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/planning.html">planning</a></span><span class="op">(</span></span>
<span>  materiality <span class="op">=</span> <span class="fl">0.03</span>, expected <span class="op">=</span> <span class="fl">0</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  likelihood <span class="op">=</span> <span class="st">"binomial"</span>, prior <span class="op">=</span> <span class="va">prior</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Bayesian Audit Sample Planning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## minimum sample size = 95 </span></span>
<span><span class="co">## sample size obtained in 96 iterations via method 'binomial' + 'prior'</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-rouder_2014" class="csl-entry">
Rouder, J. N. (2014). Optional stopping: No problem for
<span>B</span>ayesians. <em>Psychonomic Bulletin &amp; Review</em>,
<em>21</em>, 301–308. <a href="https://doi.org/10.3758/s13423-014-0595-4" class="external-link">https://doi.org/10.3758/s13423-014-0595-4</a>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://koenderks.com" class="external-link">Koen Derks</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
